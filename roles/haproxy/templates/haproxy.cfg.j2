global
  daemon
  log         127.0.0.1 local2
  maxconn 4000
  stats socket /var/lib/haproxy/stats

defaults
  log global
  mode http
  option redispatch
  option httplog
  retries 3
  timeout http-request 10s
  timeout queue 1m
  timeout connect 10s
  timeout client 1m
  timeout server 1m
  timeout check 10s

listen admin
    bind :8081
    stats enable

{% if enable_mariadb | bool %}
listen mariadb
  mode tcp
  option tcplog
  option tcpka
  option mysql-check user haproxy
  bind :3306
{% for host in groups['galera_hosts'] %}
  server {{ hostvars[host]['ansible_hostname'] }} {{ hostvars[host]['ansible_eth0']['ipv4']['address'] }}:3306 check inter 2000 rise 2 fall 5 {% if not loop.first %}backup{% endif %}

{% endfor %}
{% endif %}
